# MySQL 8.0 Hardened Configuration
# Security and Performance Optimizations

[mysqld]

# ============================================
# Security Settings
# ============================================

# Disable LOCAL INFILE (prevents loading local files)
local_infile = 0

# Disable symbolic links (prevents symlink attacks)
symbolic-links = 0

# Enable secure file privileges
secure_file_priv = /var/lib/mysql-files

# Disable SHOW DATABASES for non-privileged users
skip-show-database

# Enable strict SQL mode
sql_mode = STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION

# Bind to localhost only (change in production if needed)
bind-address = 0.0.0.0

# Enable SSL/TLS (if certificates are provided)
# require_secure_transport = ON

# ============================================
# Authentication & Password Policy
# ============================================

# Use strong password validation
validate_password.policy = STRONG
validate_password.length = 12
validate_password.mixed_case_count = 1
validate_password.number_count = 1
validate_password.special_char_count = 1

# Default authentication plugin
default_authentication_plugin = caching_sha2_password

# ============================================
# Connection Limits
# ============================================

# Maximum connections
max_connections = 200

# Connection timeout
wait_timeout = 600
interactive_timeout = 600

# Maximum connect errors before blocking
max_connect_errors = 100

# ============================================
# Query Performance & Optimization
# ============================================

# Query cache (disabled in MySQL 8.0, using InnoDB buffer pool)
# Use InnoDB buffer pool instead
innodb_buffer_pool_size = 512M
innodb_buffer_pool_instances = 2

# InnoDB settings
innodb_flush_log_at_trx_commit = 1
innodb_log_file_size = 128M
innodb_flush_method = O_DIRECT

# Thread cache
thread_cache_size = 16

# Table cache
table_open_cache = 4000
table_definition_cache = 2000

# Temporary tables
tmp_table_size = 32M
max_heap_table_size = 32M

# ============================================
# Binary Logging & Replication
# ============================================

# Enable binary logging (for point-in-time recovery)
log_bin = /var/lib/mysql/mysql-bin.log
binlog_format = ROW
expire_logs_days = 7
max_binlog_size = 100M

# Server ID (unique for each server in replication)
server-id = 1

# ============================================
# Logging
# ============================================

# Error log
log_error = /var/log/mysql/error.log

# Slow query log
slow_query_log = 1
slow_query_log_file = /var/log/mysql/slow-query.log
long_query_time = 2

# General query log (disable in production for performance)
# general_log = 1
# general_log_file = /var/log/mysql/general.log

# ============================================
# Character Set & Collation
# ============================================

character-set-server = utf8mb4
collation-server = utf8mb4_unicode_ci

# ============================================
# Network & Protocol
# ============================================

# Maximum packet size
max_allowed_packet = 64M

# Skip name resolution (use IP addresses)
skip-name-resolve

# ============================================
# InnoDB Settings
# ============================================

# File per table
innodb_file_per_table = 1

# ACID compliance
innodb_doublewrite = 1

# Lock wait timeout
innodb_lock_wait_timeout = 50

# ============================================
# MyISAM Settings (if used)
# ============================================

key_buffer_size = 32M
myisam_sort_buffer_size = 8M

[mysql]
# Auto-rehash disabled for security
no-auto-rehash

[client]
# Default character set
default-character-set = utf8mb4

# Socket
socket = /var/run/mysqld/mysqld.sock

[mysqldump]
# Quick dump
quick
quote-names
max_allowed_packet = 64M
